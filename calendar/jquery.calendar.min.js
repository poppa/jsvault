/*!
 * Creates a calendar.
 *
 * Copyright © 2009-2015 Pontus Östlund <https://profiles.google.com/poppanator>
 *
 * Permission to copy, modify, and distribute this source for any legal
 * purpose granted as long as my name is still attached to it. More
 * specifically, the GPL, LGPL and MPL licenses apply to this software.
 */
!function(t){"use strict";"getWeek"in Date||(Date.prototype.getWeek=function(){var t,e,a,n,r,i,o,s,l,d,c,h,u;return c=this.getFullYear(),h=this.getMonth()+1,u=this.getDate(),2>=h?(t=c-1,e=(t/4|0)-(t/100|0)+(t/400|0),a=((t-1)/4|0)-((t-1)/100|0)+((t-1)/400|0),l=e-a,r=0,i=u-1+31*(h-1)):(t=c,e=(t/4|0)-(t/100|0)+(t/400|0),a=((t-1)/4|0)-((t-1)/100|0)+((t-1)/400|0),l=e-a,r=l+1,i=u+(153*(h-3)+2)/5+58+l),o=(t+e)%7,n=(i+o-r)%7,s=i+3-n|0,d=0>s?53-((o-l)/5|0):s>364+l?1:(s/7|0)+1,c=h=u=null,d});var e=0,a=function(n,r,i){r||(r={}),r.minDate&&"string"==typeof r.minDate?(r.minDate=new Date(Date.parse(r.minDate)),r.minTime=r.minDate.getTime()):r.minDate&&(r.minTime=r.minDate.getTime()),r.maxDate&&"string"==typeof r.maxDate?(r.maxDate=new Date(Date.parse(r.maxDate)),r.maxTime=r.maxDate.getTime()):r.maxDate&&(r.maxTime=r.maxDate.getTime());var o=this,s=e++,l="date"+s,d={from:new Date,to:new Date},c=t('<table cellspaing="0" cellpadding="0" class="poppa-calendar">  <thead>    <tr class="nav"><td class="pdp-nav-container" colspan="7">      <table><thead><tr>      <td class="pdp-prev">        <a href="#" class="prev-year">◀</a>         <a href="#" class="prev-month">◁</a>       </td>      <td class="pdp-nav"></td>      <td class="pdp-next">        <a href="#" class="next-month">▷</a>         <a href="#" class="next-year">▶</a>       </td>      </tr></thead></table>    </td></tr>    <tr class="pdp-wdays">      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>    </tr>  </thead>  <tbody>  </tbody></table>').hide(),h=null,u=null,p=null,f=null,g=null,m=!1,D=r.showWeeks,v=!(!r.maxTime&&!r.minTime),y=r.minTime,k=r.maxTime,w=r.dayType||"short",b="short"!==w?"semi"===w?a.config.semiShortDays:a.config.weekDays:a.config.shortDays,T=function(){return g?g.getFullYear():0},x=function(){return g?g.getMonth():-1},C=function(){return g?g.getDate():0},M=function(){var t=h.find("select.pdp-year").val(),e=h.find("select.pdp-month").val(),a=C();e=parseInt(e,10)+1;var n=t+"-"+(10>e?"0"+e:e)+"-"+(10>a?"0"+a:a);O(n)},S=function(t){var e=new Date(g);e.setYear(e.getFullYear()+t),O(a.getISO8601Date(e))},Y=function(t){var e=new Date(g);e.setMonth(e.getMonth()+t),O(a.getISO8601Date(e))},j=function(t){r.clickCallback&&r.clickCallback(o,t)},F=function(t){var e=t.match(/(\d\d\d\d\-\d\d\-\d\d)\s+(.+)/),a=null,n=0,r=0;if(e){if(a=e[2].split(":"),a.length<3)for(r=a.length,n=r;n>1;n--)a.push("00");t=e[1]+"T"+a.join(":")}return t},I=function(t){return!v||t>=y&&!k||k>=t&&!y||t>=y&&k>=t},O=function(e){e?a.hashURL.set(l,e).render():a.hashURL.unset(l).render();var i=new Date,s=0;if(m||(t(n).empty().append(c),m=!0),e){if("string"==typeof e){e=F(e);try{e=g=new Date(Date.parse(e))}catch(v){throw v}}}else e=g=new Date;if(d.from.setYear(e.getFullYear()-6),d.to.setYear(e.getFullYear()+5),null===h){h=c.find("thead");var y=h.find("th");for(s=0;s<b.length;s++)t(y[s]).text(b[s]);var k=h.find(".pdp-nav");p=t('<select class="pdp-year"></select>'),f=t('<select class="pdp-month"></select>'),k.append(f),k.append(" "),k.append(p),p.change(function(){M()}),f.change(function(){M()}),h.find("a.prev-year").attr("title",a.config.prevYear).on("click",function(){return S(-1),!1}),h.find("a.prev-month").attr("title",a.config.prevMonth).on("click",function(){return Y(-1),!1}),h.find("a.next-year").attr("title",a.config.nextYear).on("click",function(){return S(1),!1}),h.find("a.next-month").attr("title",a.config.nextMonth).on("click",function(){return Y(1),!1}),D&&(h.find(".pdp-wdays").prepend('<th class="week"></th>'),h.find(".pdp-nav-container").attr("colspan","8"))}p.empty(),f.empty();for(var w=d.from.getFullYear(),C=d.to.getFullYear(),O=null,N=null,W=null,R=null,U=0;U<a.config.months.length;U++)O=t('<option value="'+U+'">'+a.config.months[U]+"</option>"),U==x()&&O.attr("selected","selected"),f.append(O);for(U=C;U>w;U--)O=t("<option>"+U+"</option>"),U==T()&&O.attr("selected","selected"),p.append(O);null===u&&(u=c.find("tbody")),u.empty();var A=new Date(e);A.setDate(1);var L=new Date(A);L.setMonth(e.getMonth()+1),L.setDate(0);var P=A.getDay();0===P&&(P=7);var H=t("<tr></tr>"),_=1,Q=function(){j(t.data(this,"date"))};if(P>1){for(N=new Date(A);P>_;_++)N=new Date(N),N.setDate(N.getDate()-1),R=N.getDay(),W=t("<td></td>").addClass("othermonth").html('<div class="daynum">'+N.getDate()+"</div>"),!r.otherMonthsNotClickable&&I(N.getTime())&&W.addClass("clickable").on(r.clickAction||"click",Q),W.addClass("wd-"+R),t.data(W[0],"date",N),H.prepend(W);D&&H.prepend('<td class="week">'+A.getWeek()+"</td>")}var q=a.getISO8601Date(i);for(_--,s=1;s<=L.getDate();s++){7===_++&&(u.append(H),H=t("<tr></tr>"),_=1);var z=t("<td></td>").html('<div class="daynum">'+s+"</div>"),B=new Date(e);B.setDate(s),D&&1===_&&H.append('<td class="week">'+B.getWeek()+"</td>");var E=B.getTime();t.data(z[0],"date",B),a.getISO8601Date(B)===q?z.addClass("current-day"):a.getISO8601Date(B)<q&&z.addClass("historical"),I(E)?z.addClass("clickable").on(r.clickAction||"click",Q):z.addClass("oob"),R=B.getDay(),z.addClass("wd-"+R),H.append(z)}if(7>_)for(var G=new Date(L);7>_;_++)G=new Date(G),G.setDate(G.getDate()+1),R=G.getDay(),W=t("<td></td>").addClass("othermonth").html('<div class="daynum">'+G.getDate()+"</div>"),!r.otherMonthsNotClickable&&I(G.getTime())&&W.addClass("clickable").on(r.clickAction||"click",Q),W.addClass("wd-"+R),t.data(W[0],"date",G),H.append(W);u.append(H),r.renderCallback&&r.renderCallback(o,e,A,L)};this.getTd=function(e){"object"==typeof e&&(e=a.getISO8601Date(e));for(var n=u.find("td"),r=n.length,i=0;r>i;i++){var o=n[i],s=t.data(o,"date");if(s&&a.getISO8601Date(s)==e)return t(o)}return null},this.getCurrentDate=function(){return g},this.getContainer=function(){return n};var N=a.hashURL.get();O(N[l]||i),r.className&&c.addClass(r.className),c.show()};a.getISO8601Date=function(t){var e=t.getFullYear(),a=t.getMonth()+1,n=t.getDate();return e+"-"+(10>a?"0"+a:a)+"-"+(10>n?"0"+n:n)},a.objectToHash=function(t){var e=[];for(var a in t)e.push(a+"="+t[a]);return e.length&&"#"+e.join("&")||void 0},a.parseHash=function(){var t,e,a={};if(t=document.location.hash,t&&t.match(/#((.*?)+=(.*?))/)){t=t.substring(1),e=t.split("&");for(var n=0;n<e.length;n++){var r=e[n].split("=");r.length>1?a[r[0]]=r[1]:a[r[0]]=""}}return a},a.getShortMonthName=function(t){return a.config.shortMonths[t]},a.getMonthName=function(t){return a.config.months[t]},a.hashURL=function(){var e,a,n,r={},i=function(t){var i=document.location.hash;if(r={},i)for(i=i.substring(1),e=i.split("&"),n=0;n<e.length;n++)a=e[n].split("="),r[a[0]]=null,a.length>1&&(r[a[0]]=decodeURIComponent(a[1]))};return i(),{update:i,set:function(e,a){if(t.isPlainObject(e))for(var n in e)this.set(n,e[n]);else e&&e.length&&"#"===e[0]&&(e=e.substring(1)),r[e]=a;return this},append:function(t,e){return r[t]?(r[t].isArray()||(r[t]=[r[t]]),r[t].push(e)):r[t]=e,this},isset:function(t){return void 0!==r[t]},get:function(t){return t?r[t]:r},unset:function(t){return t?delete r[t]:r={},this},render:function(){var t,e=[];if(0===Object.keys(r).length)return void(document.location.hash="_");for(t in r)r[t]?e.push(t+"="+encodeURIComponent(r[t])):e.push(t);e.length?document.location.hash=e.join("&"):document.location.hash="_"}}}(),a.config={prevMonth:"Previous month",prevYear:"Previous year",nextMonth:"Next month",nextYear:"Next year",weekDays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],semiShortDays:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],shortDays:["Mo","Tu","We","Th","Fr","Sa","Su"],shortMonths:["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],months:["januari","februari","mars","april","may","june","july","august","september","october","november","december"]},window.PoppaCalendar=a,t.fn.calendar=function(e){return this.each(function(){var n=t(this).attr("data-calendar-date");new a(this,e,n)})}}(jQuery);